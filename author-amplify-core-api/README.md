# Author Amplify Core API

This is the backend Core API for the Author Amplify application. It is built with [NestJS](https://nestjs.com/), a progressive Node.js framework for building efficient, reliable and scalable server-side applications.

## Table of Contents

- [Prerequisites](#prerequisites)
- [Project Setup](#project-setup)
- [Environment Variables](#environment-variables)
- [Running the Application](#running-the-application)
- [Running Tests](#running-tests)
- [Database Migrations (TypeORM)](#database-migrations-typeorm)
- [Project Structure](#project-structure)

## Prerequisites

Before you begin, ensure you have the following installed:

- [Node.js](https://nodejs.org/) (v18.x or later recommended)
- [npm](https://www.npmjs.com/) (usually comes with Node.js) or [Yarn](https://yarnpkg.com/)
- [PostgreSQL](https://www.postgresql.org/) (Database)
- [RabbitMQ](https://www.rabbitmq.com/) (Message Broker, optional for initial setup but needed for full functionality)
- An [AWS Account](https://aws.amazon.com/) (for S3 storage, optional for initial setup)
- A [Clerk.dev Account](https://clerk.com/) (for authentication)

## Project Setup

1.  **Clone the repository:**
    If this project is part of a larger monorepo or multiple repositories, ensure you clone the correct one.
    ```bash
    # If you haven't created a repository yet, you'll do this after the AI generates the initial files.
    # For now, you can create a directory for this backend service:
    mkdir author-amplify-core-api
    cd author-amplify-core-api
    # Then, you'll place the files generated by the AI into this directory.
    ```

2.  **Install dependencies:**
    Navigate to the project directory (`author-amplify-core-api`) and install the required npm packages.
    ```bash
    npm install
    ```
    Alternatively, if you prefer Yarn:
    ```bash
    yarn install
    ```

## Environment Variables

This project uses environment variables for configuration.

1.  **Create a `.env` file:**
    Copy the example environment file `.env.example` to a new file named `.env` in the root of the `author-amplify-core-api` directory.
    ```bash
    cp .env.example .env
    ```

2.  **Update `.env`:**
    Open the `.env` file and fill in the required values for your local setup and cloud services:
    - `PORT`: The port the application will run on (default: 3001).
    - `DATABASE_URL`: Your PostgreSQL connection string.
    - `CLERK_SECRET_KEY`: Your Clerk Backend API Key.
    - `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`, `AWS_S3_BUCKET_NAME`, `AWS_REGION`: Your AWS credentials for S3.
    - `RABBITMQ_URL`: Your RabbitMQ connection string.

    Refer to the comments in `.env.example` for more details on each variable.

## Running the Application

Once the project is set up and environment variables are configured:

1.  **Development mode (with hot-reloading):**
    ```bash
    npm run start:dev
    ```
    The application will typically be available at `http://localhost:3001` (or the port specified in your `.env`).

2.  **Production mode:**
    First, build the application:
    ```bash
    npm run build
    ```
    Then, start the application:
    ```bash
    npm run start:prod
    ```

## Running Tests

-   **Run all unit tests:**
    ```bash
    npm test
    ```

-   **Run tests in watch mode:**
    ```bash
    npm run test:watch
    ```

-   **Run tests with coverage report:**
    ```bash
    npm run test:cov
    ```

-   **Run E2E tests (if configured):**
    ```bash
    npm run test:e2e
    ```

## Database Migrations (TypeORM)

This project uses TypeORM for database interactions. Migrations are used to manage database schema changes.
Ensure your `DATABASE_URL` in `.env` is correctly pointing to your development database.

1.  **Generate a new migration:**
    After making changes to your entities (e.g., adding a new field or table), generate a migration file:
    ```bash
    npm run migration:generate src/migrations/YourMigrationName
    ```
    Replace `src/migrations/YourMigrationName` with the desired path and name for your migration.

2.  **Run migrations:**
    To apply all pending migrations to your database:
    ```bash
    npm run migration:run
    ```

3.  **Revert the last migration:**
    To undo the last applied migration:
    ```bash
    npm run migration:revert
    ```

    *Note: Ensure TypeORM CLI configuration is correctly set up in `package.json` scripts and potentially a `ormconfig.ts` or `typeorm.config.ts` file if not using the default `src/config/typeorm.config.ts` specified in the scripts.*

## Project Structure

The project follows a standard NestJS structure:

-   `src/`: Contains the application source code.
    -   `main.ts`: The application entry point.
    -   `app.module.ts`: The root module of the application.
    -   `config/`: Configuration files (e.g., TypeORM, S3).
    -   `common/`: Shared utilities, decorators, filters, etc.
    -   `database/`: Database module setup.
    -   `auth/`: Authentication-related logic.
    -   `users/`, `books/`, etc.: Feature-specific modules.
        -   `*.controller.ts`: Handles incoming requests and returns responses.
        -   `*.service.ts`: Contains business logic.
        -   `*.entity.ts`: TypeORM entity definitions.
        -   `*.module.ts`: NestJS module definition for the feature.
        -   `dtos/`: Data Transfer Objects for request/response validation.
-   `test/`: Contains test files.
-   `.env.example`: Example environment variables file.
-   `Dockerfile`: For containerizing the application.
-   `README.md`: This file.

For more details on NestJS, visit the [NestJS documentation](https://docs.nestjs.com/).